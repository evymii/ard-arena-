var O=Object.defineProperty;var N=(h,t,e)=>t in h?O(h,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):h[t]=e;var o=(h,t,e)=>N(h,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function e(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=e(n);fetch(n.href,r)}})();const R={TOWER:0},l={LEFT:"left",RIGHT:"right"},s={STAND:"stand",WALK:"walking",WALK_BACKWARD:"walking-backward",SQUAT:"squating",STAND_UP:"stand-up",HIGH_KICK:"high-kick",JUMP:"jumping",FORWARD_JUMP:"forward-jump",BACKWARD_JUMP:"backward-jump",LOW_KICK:"low-kick",LOW_PUNCH:"low-punch",HIGH_PUNCH:"high-punch",FALL:"fall",WIN:"win",ENDURE:"endure",SQUAT_ENDURE:"squat-endure",UPPERCUT:"uppercut",SQUAT_LOW_KICK:"squat-low-kick",SQUAT_HIGH_KICK:"squat-high-kick",SQUAT_LOW_PUNCH:"squat-low-punch",KNOCK_DOWN:"knock-down",ATTRACTIVE_STAND_UP:"attractive-stand-up",SPIN_KICK:"spin-kick",BLOCK:"blocking",FORWARD_JUMP_KICK:"forward-jump-kick",BACKWARD_JUMP_KICK:"backward-jump-kick",BACKWARD_JUMP_PUNCH:"backward-jump-punch",FORWARD_JUMP_PUNCH:"forward-jump-punch"},c={IMAGES:"/images/",ARENAS:"arenas/",FIGHTERS:"fighters/",STEP_DURATION:80,PLAYER_TOP:230,BLOCK_DAMAGE:.2,ARENA_WIDTH:600,ARENA_HEIGHT:400};class H{constructor(t){o(this,"width");o(this,"height");o(this,"arena");o(this,"fighters");o(this,"container");o(this,"game");o(this,"canvas");o(this,"context");o(this,"texture");this.width=t.width||c.ARENA_WIDTH,this.height=t.height||c.ARENA_HEIGHT,this.arena=t.arena||R.TOWER,this.fighters=t.fighters,this.container=t.container,this.game=t.game}init(){const t=document.createElement("canvas");t.width=this.width,t.height=this.height,this.container.appendChild(t);const e=t.getContext("2d");if(!e)throw new Error("Could not get 2d context");this.context=e,this.canvas=t,this.refresh()}destroy(){this.canvas&&this.container.contains(this.canvas)&&this.container.removeChild(this.canvas),this.canvas=void 0,this.context=void 0,this.container=void 0,this.game=void 0,this.fighters=void 0,this.arena=void 0}drawArena(){if(this.context)if(this.texture)this.context.drawImage(this.texture,0,0,this.width,this.height);else{const t=document.createElement("img");t.src=`${c.IMAGES}${c.ARENAS}${this.arena}/arena.png`,t.width=this.width,t.height=this.height,t.onload=()=>{this.texture=t,this.context&&this.context.drawImage(t,0,0,this.width,this.height)}}}refresh(){if(this.context){this.drawArena();for(let t=0;t<this.fighters.length;t+=1){const e=this.fighters[t],i=e.getState();i&&this.context.drawImage(i,e.getX(),e.getY())}}}moveFighter(t,e){const i=this.game.getOpponent(t),n={x:i.getX(),y:i.getY()},r=e.y+t.getVisibleHeight()<=n.y;return e.x<=0&&(e.x=0),e.x>=this.width-t.getVisibleWidth()&&(e.x=this.width-t.getVisibleWidth()),r||(t.getOrientation()===l.LEFT?e.x+t.getVisibleWidth()>n.x&&(e=this.synchronizeFighters(e,t,i)):e.x<n.x+i.getVisibleWidth()&&(e=this.synchronizeFighters(e,t,i))),this.setFightersOrientation(t,i),e}synchronizeFighters(t,e,i){const n=e.getMove().type;if(n===s.FORWARD_JUMP||n===s.BACKWARD_JUMP)return t.x=e.getX(),t;let r;return e.getOrientation()===l.LEFT?(r=Math.min(this.width-(i.getX()+i.getVisibleWidth()+e.getVisibleWidth()),t.x-e.getX()),t.x=e.getX()+r,r>0&&i.setX(i.getX()+r)):(r=Math.min(i.getX(),e.getX()-t.x),r>0?(t.x=e.getX()-r,i.setX(i.getX()-r),i.getX()+i.getWidth()>t.x&&(t.x=i.getX()+i.getVisibleWidth())):(t.x=e.getX(),i.getX()+i.getWidth()>t.x&&(t.x=i.getX()+i.getVisibleWidth()))),t}setFightersOrientation(t,e){t.getX()<e.getX()?(t.setOrientation(l.LEFT),e.setOrientation(l.RIGHT)):(t.setOrientation(l.RIGHT),e.setOrientation(l.LEFT))}}class _{constructor(t,e,i){o(this,"owner");o(this,"type");o(this,"stepDuration");o(this,"interval",-1);o(this,"currentStep",0);o(this,"actionPending",null);o(this,"steps",{left:[],right:[]});o(this,"totalSteps",0);this.owner=t,this.type=e,this.stepDuration=i||c.STEP_DURATION}go(t){typeof this._beforeGo=="function"&&this._beforeGo.call(this),this.currentStep=t||0,this.nextStep(()=>{typeof this._action=="function"&&this._action.call(this)}),this.interval=window.setInterval(()=>{this.nextStep(()=>{typeof this._action=="function"&&this._action.call(this)})},this.stepDuration)}nextStep(t){const e=this.steps[this.owner.getOrientation()][this.currentStep];this.owner.setState(e),t(),this.owner.refresh(),this.moveNextStep()}init(t){let e=0;const i={LEFT:"left",RIGHT:"right"};this.steps={left:[],right:[]};for(let n=0;n<this.totalSteps;n+=1)for(const r in i){const a=i[r],u=document.createElement("img");u.onload=()=>{e+=1,e===this.totalSteps*2&&t()},u.src=this.getImageUrl(n,a),this.steps[a].push(u)}typeof this.addHandlers=="function"&&this.addHandlers.call(this)}getImageUrl(t,e){return`${c.IMAGES}${c.FIGHTERS}${this.owner.getName()}/${e}/${this.type}/${t}.png`}stop(t){if(typeof this._beforeStop=="function"&&this._beforeStop.call(this),this.interval!==-1&&(clearInterval(this.interval),this.interval=-1),typeof this.actionPending=="function"){const e=this.actionPending;this.actionPending=null,e()}}}class S extends _{constructor(t,e,i,n){super(t,e,n),this.totalSteps=i}moveNextStep(){this.currentStep+=1,this.currentStep=this.currentStep%this.totalSteps}}class T extends S{constructor(t){super(t,s.STAND,9)}_beforeGo(){this.owner.setY(c.PLAYER_TOP)}}class I extends S{constructor(t){super(t,s.WALK,9)}_action(){this.owner.setX(this.owner.getX()+10),this.owner.setY(c.PLAYER_TOP)}}class L extends S{constructor(t){super(t,s.WALK_BACKWARD,9)}_action(){this.owner.setX(this.owner.getX()-10),this.owner.setY(c.PLAYER_TOP)}}class p extends _{constructor(e,i,n){super(e,i,n);o(this,"bottom");this.bottom=void 0}moveNextStep(){this.currentStep>=this.totalSteps-1?this.currentStep=this.totalSteps-1:this.currentStep+=1}_beforeGo(){this.bottom=this.owner.getBottom(),this.owner.lock()}_beforeStop(){this.owner.unlock()}keepDistance(){if(this.bottom===void 0)return;const e=this.owner.getBottom();e>this.bottom&&this.owner.setY(this.owner.getY()+e-this.bottom),e<this.bottom&&this.owner.setY(this.owner.getY()-(this.bottom-e))}}class y extends p{constructor(t){super(t,s.SQUAT,40),this.totalSteps=3}_action(){this.keepDistance(),this.currentStep===2&&this.stop()}}class E extends p{constructor(t){super(t,s.BLOCK,40),this.totalSteps=3}_action(){this.keepDistance(),this.currentStep===2&&this.stop()}}class J extends p{constructor(t){super(t,s.STAND_UP,100),this.totalSteps=3}_action(){this.currentStep===2&&(this.stop(),this.owner.setMove(s.STAND),this.owner.setY(c.PLAYER_TOP)),this.keepDistance()}}class b extends p{constructor(t){super(t,s.ATTRACTIVE_STAND_UP,100),this.totalSteps=4}_action(){this.currentStep===this.totalSteps-1?(this.stop(),this.owner.setMove(s.STAND)):this.keepDistance()}_beforeStop(){this.owner.unlock(),this.owner.setY(c.PLAYER_TOP)}}class g extends _{constructor(e,i,n,r,a,u,f){super(e,i,a||40);o(this,"damage");o(this,"moveBack",!1);o(this,"hitPassed",!1);o(this,"returnStand");o(this,"returnStandStep");o(this,"dontReturn",!1);o(this,"bottom");this.damage=r,this.totalSteps=n,this.returnStand=u||s.STAND,this.returnStandStep=f||0}moveNextStep(){this.moveBack||(this.currentStep+=1),this.moveBack&&(this.currentStep-=1,this.currentStep<=0&&(this.stop(),this.owner.setMove(this.returnStand,this.returnStandStep))),this.currentStep>=this.totalSteps&&(this.dontReturn?(this.stop(),this.owner.setMove(this.returnStand)):(this.moveBack=!0,this.currentStep-=1))}_action(){this.keepDistance(),!this.hitPassed&&this.currentStep===Math.round(this.totalSteps/2)&&(this.owner.attack(this.getDamage()),this.hitPassed=!0)}getDamage(){return this.damage}_beforeStop(){this.owner.unlock()}_beforeGo(){this.moveBack=!1,this.hitPassed=!1,this.owner.lock(),this.bottom=this.owner.getBottom()}keepDistance(){if(this.bottom===void 0)return;const e=this.owner.getBottom();e>this.bottom&&this.owner.setY(this.owner.getY()+e-this.bottom),e<this.bottom&&this.owner.setY(this.owner.getY()-(this.bottom-e))}}class B extends g{constructor(t){super(t,s.HIGH_KICK,7,10)}}class F extends g{constructor(t){super(t,s.LOW_KICK,6,6)}}class x extends g{constructor(t){super(t,s.SPIN_KICK,8,13,60,s.STAND),this.dontReturn=!0}}class k extends g{constructor(t){super(t,s.LOW_PUNCH,5,5)}}class G extends g{constructor(t){super(t,s.HIGH_PUNCH,5,8)}}class Y extends g{constructor(t){super(t,s.UPPERCUT,5,13,60)}_beforeStop(){this.owner.unlock(),this.keepDistance()}_action(){this.keepDistance(),!this.hitPassed&&this.currentStep===Math.round(this.totalSteps/2)&&(this.owner.attack(this.getDamage()),this.hitPassed=!0)}}class X extends g{constructor(t){super(t,s.SQUAT_LOW_KICK,3,4,70,s.SQUAT,2)}}class Q extends g{constructor(t){super(t,s.SQUAT_HIGH_KICK,4,6,70,s.SQUAT,2)}}class V extends g{constructor(t){super(t,s.SQUAT_LOW_PUNCH,3,4,70,s.SQUAT,2)}}class z extends p{constructor(t){super(t,s.FALL,100),this.totalSteps=7}_action(){this.keepDistance()}}class j extends _{constructor(t){super(t,s.KNOCK_DOWN,80),this.totalSteps=10}_action(){if(this.currentStep===this.totalSteps-1)this.stop(),this.owner.setMove(s.ATTRACTIVE_STAND_UP);else{let t=25;this.owner.getOrientation()===l.LEFT&&(t=-t),this.currentStep+1>(this.totalSteps-1)/2?(this.owner.setY(this.owner.getY()+10),this.owner.setX(this.owner.getX()+t)):(this.owner.setY(this.owner.getY()+10),this.owner.setX(this.owner.getX()+t))}}_beforeGo(){this.owner.lock()}_beforeStop(){this.owner.unlock()}moveNextStep(){this.currentStep+=1}}class q extends p{constructor(t){super(t,s.WIN,100),this.totalSteps=10}_action(){this.keepDistance()}_beforeGo(){this.owner.lock(),this.owner.setY(c.PLAYER_TOP),this.bottom=this.owner.getBottom()}}class $ extends _{constructor(e){super(e,s.JUMP,60);o(this,"moveBack",!1);this.totalSteps=6,this.moveBack=!1}moveNextStep(){this.moveBack||(this.currentStep+=1),this.moveBack&&(this.currentStep-=1,this.currentStep<=0&&(this.stop(),this.owner.setMove(s.STAND))),this.currentStep>=this.totalSteps&&(this.moveBack=!0,this.currentStep-=1)}_action(){this.moveBack?this.currentStep===this.totalSteps-1?this.owner.setY(this.owner.getY()-20):this.owner.setY(this.owner.getY()+25):this.currentStep===0?this.owner.setY(this.owner.getY()+20):this.owner.setY(this.owner.getY()-20)}_beforeStop(){this.owner.unlock()}_beforeGo(){this.moveBack=!1,this.owner.lock()}}class D extends g{constructor(e,i,n,r){super(e,i,3,n,80);o(this,"offset");o(this,"totalPics",2);o(this,"counter",0);this.offset={x:-23,y:26},r&&(this.offset={x:23,y:26}),this.totalPics=2,this.counter=0}moveNextStep(){this.currentStep+=1,this.counter+=1,this.totalPics<=this.currentStep&&(this.currentStep=this.totalPics),this.counter>=this.totalSteps&&this.owner.getMove().type!==s.WIN&&(this.stop(),this.owner.setMove(s.STAND),this.owner.setY(c.PLAYER_TOP))}_action(){!this.hitPassed&&this.currentStep===this.totalPics&&(this.owner.attack(this.getDamage()),this.hitPassed=!0),this.owner.setY(this.owner.getY()+this.offset.y),this.owner.setX(this.owner.getX()+this.offset.x)}_beforeGo(){this.hitPassed=!1,this.counter=0,this.owner.lock()}}class m extends D{constructor(t,e){const i=e?s.FORWARD_JUMP_KICK:s.BACKWARD_JUMP_KICK;super(t,i,10,e)}}class U extends D{constructor(t,e){const i=e?s.FORWARD_JUMP_PUNCH:s.BACKWARD_JUMP_PUNCH;super(t,i,9,e)}}class Z extends _{constructor(e){super(e,s.FORWARD_JUMP,80);o(this,"ownerHeight");this.totalSteps=8,this.ownerHeight=e.getVisibleHeight()}_beforeStop(){this.owner.unlock(),this.owner.setHeight(this.ownerHeight)}_beforeGo(){this.owner.lock(),this.owner.setHeight(this.ownerHeight/2)}moveNextStep(){this.currentStep+=1,this.currentStep>=this.totalSteps&&(this.stop(),this.owner.setMove(s.STAND))}_action(){this.currentStep>(this.totalSteps-1)/2?(this.owner.setY(this.owner.getY()+26),this.owner.setX(this.owner.getX()+23)):(this.owner.setY(this.owner.getY()-26),this.owner.setX(this.owner.getX()+23))}}class tt extends _{constructor(e){super(e,s.BACKWARD_JUMP,80);o(this,"ownerHeight");this.totalSteps=8,this.ownerHeight=e.getVisibleHeight()}_beforeStop(){this.owner.unlock(),this.owner.setHeight(this.ownerHeight)}_beforeGo(){this.owner.lock(),this.owner.setHeight(this.ownerHeight/2)}moveNextStep(){this.currentStep+=1,this.currentStep>=this.totalSteps&&(this.stop(),this.owner.setMove(s.STAND))}_action(){this.currentStep>(this.totalSteps-1)/2?(this.owner.setY(this.owner.getY()+26),this.owner.setX(this.owner.getX()-23)):(this.owner.setY(this.owner.getY()-26),this.owner.setX(this.owner.getX()-23))}}class et extends _{constructor(t){super(t,s.ENDURE),this.totalSteps=3}_action(){this.currentStep===this.totalSteps-1&&(this.stop(),this.owner.setMove(s.STAND))}_beforeGo(){this.owner.lock()}_beforeStop(){this.owner.unlock()}moveNextStep(){this.currentStep+=1}}class st extends _{constructor(e){super(e,s.SQUAT_ENDURE);o(this,"bottom");this.totalSteps=3}_action(){this.currentStep===this.totalSteps-1&&(this.stop(),this.owner.setMove(s.SQUAT)),this.keepDistance()}_beforeGo(){this.owner.lock(),this.bottom===void 0&&(this.bottom=this.owner.getBottom())}_beforeStop(){this.owner.unlock()}moveNextStep(){this.currentStep+=1}keepDistance(){if(this.bottom===void 0)return;const e=this.owner.getBottom();e>this.bottom&&this.owner.setY(this.owner.getY()+e-this.bottom),e<this.bottom&&this.owner.setY(this.owner.getY()-(this.bottom-e))}}class it{constructor(t){o(this,"name");o(this,"arena");o(this,"game");o(this,"life",100);o(this,"orientation");o(this,"width",30);o(this,"height",60);o(this,"locked",!1);o(this,"position");o(this,"currentState");o(this,"currentMove");o(this,"moves",{});const e=t.name.toLowerCase();if(e!=="subzero"&&e!=="kano")throw new Error("Invalid fighter name!");this.name=e,this.arena=t.arena,this.game=t.game,this.orientation=t.orientation,this.position={x:50,y:c.PLAYER_TOP}}init(t){this.moves[s.STAND]=new T(this),this.moves[s.WALK]=new I(this),this.moves[s.WALK_BACKWARD]=new L(this),this.moves[s.SQUAT]=new y(this),this.moves[s.BLOCK]=new E(this),this.moves[s.STAND_UP]=new J(this),this.moves[s.ATTRACTIVE_STAND_UP]=new b(this),this.moves[s.HIGH_KICK]=new B(this),this.moves[s.LOW_KICK]=new F(this),this.moves[s.SPIN_KICK]=new x(this),this.moves[s.LOW_PUNCH]=new k(this),this.moves[s.HIGH_PUNCH]=new G(this),this.moves[s.UPPERCUT]=new Y(this),this.moves[s.SQUAT_LOW_KICK]=new X(this),this.moves[s.SQUAT_HIGH_KICK]=new Q(this),this.moves[s.SQUAT_LOW_PUNCH]=new V(this),this.moves[s.FALL]=new z(this),this.moves[s.KNOCK_DOWN]=new j(this),this.moves[s.WIN]=new q(this),this.moves[s.JUMP]=new $(this),this.moves[s.FORWARD_JUMP_KICK]=new m(this,!0),this.moves[s.BACKWARD_JUMP_KICK]=new m(this,!1),this.moves[s.FORWARD_JUMP_PUNCH]=new U(this,!0),this.moves[s.BACKWARD_JUMP_PUNCH]=new U(this,!1),this.moves[s.ENDURE]=new et(this),this.moves[s.SQUAT_ENDURE]=new st(this),this.moves[s.FORWARD_JUMP]=new Z(this),this.moves[s.BACKWARD_JUMP]=new tt(this);let e=0;const i=Object.keys(this.moves).length;for(const n in this.moves)this.moves[n].init(()=>{e+=1,e===i&&typeof t=="function"&&t()})}isJumping(){if(!this.currentMove)return!1;const t=this.currentMove.type;return t===s.JUMP||t===s.BACKWARD_JUMP||t===s.FORWARD_JUMP||t===s.FORWARD_JUMP_KICK||t===s.BACKWARD_JUMP_KICK||t===s.FORWARD_JUMP_PUNCH||t===s.BACKWARD_JUMP_PUNCH}getName(){return this.name}setArena(t){this.arena=t}getWidth(){return this.currentState&&this.currentState.width?this.currentState.width:this.width}getVisibleWidth(){return this.width}getVisibleHeight(){return this.currentState&&this.currentState.height?this.currentState.height:this.height}setHeight(t){this.height=t}setWidth(t){this.width=t}setOrientation(t){this.orientation=t}getOrientation(){return this.orientation}refresh(){this.arena&&typeof this.arena.refresh=="function"&&this.arena.refresh()}getX(){return this.position.x}lock(){this.locked=!0}unlock(){this.locked=!1}getY(){return this.position.y}setX(t){this.arena?this.position.x=this.arena.moveFighter(this,{x:t,y:this.getY()}).x:this.position.x=t}setY(t){this.position.y=t}setState(t){this.currentState=t}getState(){return this.currentState}attack(t){this.game.fighterAttacked(this,t)}endureAttack(t,e){return this.getMove().type===s.BLOCK?t*=c.BLOCK_DAMAGE:(this.unlock(),this.getMove().type===s.SQUAT?this.setMove(s.SQUAT_ENDURE):e===s.UPPERCUT||e===s.SPIN_KICK?this.setMove(s.KNOCK_DOWN):this.setMove(s.ENDURE)),this.setLife(this.getLife()-t),this.getLife()===0&&(this.game.fighterDead(this),this.unlock(),this.setMove(s.FALL)),this.getLife()}setLife(t){this.life=Math.max(t,0)}getLife(){return this.life}getBottom(){if(!this.arena||!this.currentState)return 0;const t=this.currentState.height+this.getY();return this.arena.height-t}setMove(t,e){var n;e=e||0;const i=this.currentMove;if(!(t in this.moves))throw new Error(`This player does not have the move - ${t}`);this.currentMove&&this.currentMove.type===t||((t===s.FORWARD_JUMP_KICK||t===s.BACKWARD_JUMP_KICK||t===s.FORWARD_JUMP_PUNCH||t===s.BACKWARD_JUMP_PUNCH)&&i&&i._currentStep>=i._totalSteps/2&&((n=this.currentMove)==null||n.stop(),this.unlock(),this.currentMove=this.moves[t],this.currentMove._totalSteps=i._totalSteps-i._currentStep),!(this.locked&&t!==s.WIN)&&(this.currentMove&&typeof this.currentMove.stop=="function"&&this.currentMove.stop(),this.currentMove=this.moves[t],this.currentMove.go(e)))}getMove(){if(!this.currentMove)throw new Error("No current move set");return this.currentMove}}class d{constructor(t){o(this,"fighters",[]);o(this,"opponents",new Map);o(this,"arena");o(this,"callbacks");this.callbacks=t.callbacks||{},this.initializeFighters(t.fighters);const e={fighters:this.fighters,arena:t.arena.arena,width:t.arena.width,height:t.arena.height,container:t.arena.container,game:this};this.arena=new H(e)}initializeFighters(t){this.fighters=[],this.opponents=new Map;for(let e=0;e<t.length;e+=1){const i=t[e],n=e===0?l.LEFT:l.RIGHT;this.fighters.push(new it({name:i.name,arena:void 0,orientation:n,game:this}))}this.fighters.length>=2&&(this.opponents.set(this.fighters[0].getName(),this.fighters[1]),this.opponents.set(this.fighters[1].getName(),this.fighters[0]))}getOpponent(t){const e=this.opponents.get(t.getName());if(!e)throw new Error("Opponent not found");return e}init(t){let e=0;const i=this.fighters.length,n=this;for(let r=0;r<this.fighters.length;r+=1){const a=this.fighters[r];a.init(()=>{a.setMove(s.STAND),e+=1,e===i&&(n.arena.init(),n.setFightersArena(),n.initialize(),t.initialized())})}}setFightersArena(){for(let t=0;t<this.fighters.length;t+=1)this.fighters[t].setArena(this.arena);this.fighters[1].setX(470)}fighterAttacked(t,e){const i=this.getOpponent(t),n=i.getLife();if(this.requiredDistance(t,i)&&this.attackCompatible(t.getMove().type,i.getMove().type)){i.endureAttack(e,t.getMove().type);const r=this.callbacks.attack;typeof r=="function"&&r.call(null,t,i,n-i.getLife())}}attackCompatible(t,e){return!(e===s.SQUAT&&t!==s.LOW_PUNCH&&t!==s.LOW_KICK)}requiredDistance(t,e){const i=t.getX()+t.getWidth()/2,n=e.getX()+e.getWidth()/2,r=Math.abs(i-n),a=t.getMove().type,u=e.getWidth();return r<=u||a===s.UPPERCUT&&r<=u*1.2||(a===s.BACKWARD_JUMP_KICK||a===s.FORWARD_JUMP_KICK||a===s.FORWARD_JUMP_PUNCH||a===s.BACKWARD_JUMP_PUNCH)&&r<=u*1.5}fighterDead(t){const e=this.getOpponent(t),i=this.callbacks["game-end"];e.getMove().stop(),e.setMove(s.WIN),typeof i=="function"&&i.call(null,t)}reset(){this.fighters.forEach(t=>{t.getMove().stop()}),this.fighters=[],this.opponents=new Map,this.arena.destroy(),this.arena=void 0,this.callbacks={}}}class rt{constructor(){o(this,"callbacks",[])}initialized(){this.callbacks.forEach(t=>{typeof t=="function"&&t()})}ready(t){this.callbacks.push(t)}}const K={RIGHT:39,LEFT:37,UP:38,DOWN:40,BLOCK:16,HP:65,LP:83,LK:68,HK:70};class w extends d{constructor(e){super(e);o(this,"player",0);o(this,"pressed",{})}initialize(){this.player=0,this.addHandlers()}addHandlers(){const e=this.fighters[this.player];document.addEventListener("keydown",i=>{this.pressed[i.keyCode]=!0;const n=this.getMove(this.pressed,K,this.player);this.moveFighter(e,n)},!1),document.addEventListener("keyup",i=>{delete this.pressed[i.keyCode];const n=this.getMove(this.pressed,K,this.player);this.moveFighter(e,n)},!1)}moveFighter(e,i){i&&e.setMove(i)}getMove(e,i,n){const r=this.fighters[n],a=l.LEFT,u=l.RIGHT,f=r.getOrientation();return r.getMove().type===s.SQUAT&&!e[i.DOWN]?s.STAND_UP:r.getMove().type===s.BLOCK&&!e[i.BLOCK]||Object.keys(e).length===0?s.STAND:e[i.BLOCK]?s.BLOCK:e[i.LEFT]?e[i.UP]?s.BACKWARD_JUMP:e[i.HK]&&f===a?s.SPIN_KICK:s.WALK_BACKWARD:e[i.RIGHT]?e[i.UP]?s.FORWARD_JUMP:e[i.HK]&&f===u?s.SPIN_KICK:s.WALK:e[i.DOWN]?e[i.HP]?s.UPPERCUT:e[i.LK]?s.SQUAT_LOW_KICK:e[i.HK]?s.SQUAT_HIGH_KICK:e[i.LP]?s.SQUAT_LOW_PUNCH:s.SQUAT:e[i.HK]?r.getMove().type===s.FORWARD_JUMP?s.FORWARD_JUMP_KICK:r.getMove().type===s.BACKWARD_JUMP?s.BACKWARD_JUMP_KICK:s.HIGH_KICK:e[i.UP]?s.JUMP:e[i.LK]?r.getMove().type===s.FORWARD_JUMP?s.FORWARD_JUMP_KICK:r.getMove().type===s.BACKWARD_JUMP?s.BACKWARD_JUMP_KICK:s.LOW_KICK:e[i.LP]?r.getMove().type===s.FORWARD_JUMP?s.FORWARD_JUMP_PUNCH:r.getMove().type===s.BACKWARD_JUMP?s.BACKWARD_JUMP_PUNCH:s.LOW_PUNCH:e[i.HP]?r.getMove().type===s.FORWARD_JUMP?s.FORWARD_JUMP_PUNCH:r.getMove().type===s.BACKWARD_JUMP?s.BACKWARD_JUMP_PUNCH:s.HIGH_PUNCH:null}}const C={RIGHT:74,LEFT:71,UP:89,DOWN:72,BLOCK:16,HP:65,LP:83,LK:68,HK:70},v={RIGHT:39,LEFT:37,UP:38,DOWN:40,BLOCK:17,HP:80,LP:219,LK:221,HK:220};class nt extends d{constructor(e){super(e);o(this,"pressed",{})}initialize(){this.addHandlers()}addHandlers(){const e=this.fighters[0],i=this.fighters[1];document.addEventListener("keydown",n=>{this.pressed[n.keyCode]=!0;let r=this.getMove(this.pressed,C,0);this.moveFighter(e,r),r=this.getMove(this.pressed,v,1),this.moveFighter(i,r)},!1),document.addEventListener("keyup",n=>{delete this.pressed[n.keyCode];let r=this.getMove(this.pressed,C,0);this.moveFighter(e,r),r=this.getMove(this.pressed,v,1),this.moveFighter(i,r)},!1)}getMove(e,i,n){const r=this.fighters[n],a="left",u="right",f=r.getOrientation();return r.getMove().type===s.SQUAT&&!e[i.DOWN]?s.STAND_UP:r.getMove().type===s.BLOCK&&!e[i.BLOCK]||Object.keys(e).length===0?s.STAND:e[i.BLOCK]?s.BLOCK:e[i.LEFT]?e[i.UP]?s.BACKWARD_JUMP:e[i.HK]&&f===a?s.SPIN_KICK:s.WALK_BACKWARD:e[i.RIGHT]?e[i.UP]?s.FORWARD_JUMP:e[i.HK]&&f===u?s.SPIN_KICK:s.WALK:e[i.DOWN]?e[i.HP]?s.UPPERCUT:e[i.LK]?s.SQUAT_LOW_KICK:e[i.HK]?s.SQUAT_HIGH_KICK:e[i.LP]?s.SQUAT_LOW_PUNCH:s.SQUAT:e[i.HK]?r.getMove().type===s.FORWARD_JUMP?s.FORWARD_JUMP_KICK:r.getMove().type===s.BACKWARD_JUMP?s.BACKWARD_JUMP_KICK:s.HIGH_KICK:e[i.UP]?s.JUMP:e[i.LK]?r.getMove().type===s.FORWARD_JUMP?s.FORWARD_JUMP_KICK:r.getMove().type===s.BACKWARD_JUMP?s.BACKWARD_JUMP_KICK:s.LOW_KICK:e[i.LP]?r.getMove().type===s.FORWARD_JUMP?s.FORWARD_JUMP_PUNCH:r.getMove().type===s.BACKWARD_JUMP?s.BACKWARD_JUMP_PUNCH:s.LOW_PUNCH:e[i.HP]?r.getMove().type===s.FORWARD_JUMP?s.FORWARD_JUMP_PUNCH:r.getMove().type===s.BACKWARD_JUMP?s.BACKWARD_JUMP_PUNCH:s.HIGH_PUNCH:null}moveFighter(e,i){i&&e.setMove(i)}}const A={EVENT:"event",LIFE_UPDATE:"life-update",POSITION_UPDATE:"position-update",PLAYER_CONNECTED:"player-connected"},M={CREATE_GAME:"create-game",JOIN_GAME:"join-game"},ot={SUCCESS:0};class ht extends d{constructor(e){super(e);o(this,"isHost");o(this,"gameName");o(this,"transport");o(this,"player",0);o(this,"pressed",{});this.isHost=e.isHost,this.gameName=e.gameName,this.transport=e.transport}initialize(){this.isHost?this.player=1:this.player=0,this.addHandlers(),this.transport&&(this.transport.on("connect",()=>{this.isHost?this.createGame():this.joinGame()}),this.transport.on("response",e=>{e!==ot.SUCCESS&&alert("Error while connecting to the server.")}),this.transport.on("disconnect",()=>{alert("Disconnected from the server.")}))}addHandlers(){const e=this.fighters[this.player];document.addEventListener("keydown",i=>{this.pressed[i.keyCode]=!0;const n=this.getMove(this.pressed,K,this.player);this.moveFighter(e,n)},!1),document.addEventListener("keyup",i=>{delete this.pressed[i.keyCode];const n=this.getMove(this.pressed,K,this.player);this.moveFighter(e,n)},!1)}getMove(e,i,n){const r=this.fighters[n],a="left",u="right",f=r.getOrientation();return r.getMove().type===s.SQUAT&&!e[i.DOWN]?s.STAND_UP:r.getMove().type===s.BLOCK&&!e[i.BLOCK]||Object.keys(e).length===0?s.STAND:e[i.BLOCK]?s.BLOCK:e[i.LEFT]?e[i.UP]?s.BACKWARD_JUMP:e[i.HK]&&f===a?s.SPIN_KICK:s.WALK_BACKWARD:e[i.RIGHT]?e[i.UP]?s.FORWARD_JUMP:e[i.HK]&&f===u?s.SPIN_KICK:s.WALK:e[i.DOWN]?e[i.HP]?s.UPPERCUT:e[i.LK]?s.SQUAT_LOW_KICK:e[i.HK]?s.SQUAT_HIGH_KICK:e[i.LP]?s.SQUAT_LOW_PUNCH:s.SQUAT:e[i.HK]?r.getMove().type===s.FORWARD_JUMP?s.FORWARD_JUMP_KICK:r.getMove().type===s.BACKWARD_JUMP?s.BACKWARD_JUMP_KICK:s.HIGH_KICK:e[i.UP]?s.JUMP:e[i.LK]?r.getMove().type===s.FORWARD_JUMP?s.FORWARD_JUMP_KICK:r.getMove().type===s.BACKWARD_JUMP?s.BACKWARD_JUMP_KICK:s.LOW_KICK:e[i.LP]?r.getMove().type===s.FORWARD_JUMP?s.FORWARD_JUMP_PUNCH:r.getMove().type===s.BACKWARD_JUMP?s.BACKWARD_JUMP_PUNCH:s.LOW_PUNCH:e[i.HP]?r.getMove().type===s.FORWARD_JUMP?s.FORWARD_JUMP_PUNCH:r.getMove().type===s.BACKWARD_JUMP?s.BACKWARD_JUMP_PUNCH:s.HIGH_PUNCH:null}createGame(){this.transport&&(this.transport.emit(M.CREATE_GAME,this.gameName),this.addSocketHandlers())}joinGame(){this.transport&&(this.transport.emit(M.JOIN_GAME,this.gameName),this.addSocketHandlers())}addSocketHandlers(){if(!this.transport)return;const e=this.fighters[+!this.player],i=this.fighters[this.player],n=this;this.transport.on(A.EVENT,r=>{e.setMove(r)}),this.transport.on(A.LIFE_UPDATE,r=>{e.setLife(r)}),this.transport.on(A.POSITION_UPDATE,r=>{e.setX(r.x),e.setY(r.y)}),setInterval(()=>{n.transport&&n.transport.emit(A.LIFE_UPDATE,i.getLife())},2e3),setInterval(()=>{!i.isJumping()&&n.transport&&n.transport.emit(A.POSITION_UPDATE,{x:i.getX(),y:i.getY()})},500),this.isHost&&this.transport.on(A.PLAYER_CONNECTED,()=>{const r=this.callbacks["player-connected"];typeof r=="function"&&r()})}moveFighter(e,i){i&&this.transport&&(this.transport.emit(A.EVENT,i),e.setMove(i))}}let P=null;function at(h){const t=(h.gameType||"basic").toLowerCase(),e=new rt;switch(t){case"basic":P=new w(h);break;case"network":P=new ht(h);break;case"multiplayer":P=new nt(h);break;default:P=new w(h)}return P.init(e),e}const W=document.getElementById("app");if(!W)throw new Error("App element not found");const ct=at({arena:{container:W,arena:R.TOWER,width:600,height:400},fighters:[{name:"subzero"},{name:"kano"}],gameType:"basic",callbacks:{attack:(h,t,e)=>{console.log(`${h.getName()} attacked ${t.getName()} for ${e} damage`)},"game-end":h=>{console.log(`Game ended! ${h.getName()} lost`)}}});ct.ready(()=>{console.log("Game initialized and ready!")});
