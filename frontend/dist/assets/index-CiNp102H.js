var b=Object.defineProperty;var B=(h,t,e)=>t in h?b(h,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):h[t]=e;var o=(h,t,e)=>B(h,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function e(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(r){if(r.ep)return;r.ep=!0;const n=e(r);fetch(r.href,n)}})();const N={TOWER:0},f={LEFT:"left",RIGHT:"right"},i={STAND:"stand",WALK:"walking",WALK_BACKWARD:"walking-backward",SQUAT:"squating",STAND_UP:"stand-up",HIGH_KICK:"high-kick",JUMP:"jumping",FORWARD_JUMP:"forward-jump",BACKWARD_JUMP:"backward-jump",LOW_KICK:"low-kick",LOW_PUNCH:"low-punch",HIGH_PUNCH:"high-punch",FALL:"fall",WIN:"win",ENDURE:"endure",SQUAT_ENDURE:"squat-endure",UPPERCUT:"uppercut",SQUAT_LOW_KICK:"squat-low-kick",SQUAT_HIGH_KICK:"squat-high-kick",SQUAT_LOW_PUNCH:"squat-low-punch",KNOCK_DOWN:"knock-down",ATTRACTIVE_STAND_UP:"attractive-stand-up",SPIN_KICK:"spin-kick",BLOCK:"blocking",FORWARD_JUMP_KICK:"forward-jump-kick",BACKWARD_JUMP_KICK:"backward-jump-kick",BACKWARD_JUMP_PUNCH:"backward-jump-punch",FORWARD_JUMP_PUNCH:"forward-jump-punch"},u={IMAGES:"/images/",ARENAS:"arenas/",FIGHTERS:"fighters/",STEP_DURATION:80,PLAYER_TOP:600,BLOCK_DAMAGE:.2,ARENA_WIDTH:1200,ARENA_HEIGHT:800};class J{constructor(t){o(this,"width");o(this,"height");o(this,"arena");o(this,"fighters");o(this,"container");o(this,"game");o(this,"canvas");o(this,"context");o(this,"texture");o(this,"timeRemaining",60);o(this,"timerInterval");this.width=t.width||u.ARENA_WIDTH,this.height=t.height||u.ARENA_HEIGHT,this.arena=t.arena||N.TOWER,this.fighters=t.fighters,this.container=t.container,this.game=t.game}init(){const t=document.createElement("canvas");t.width=this.width,t.height=this.height,t.style.width=`${this.width}px`,t.style.height=`${this.height}px`,t.style.display="block",t.style.maxWidth="none",t.style.maxHeight="none",t.style.minWidth=`${this.width}px`,t.style.minHeight=`${this.height}px`,this.container.appendChild(t);const e=t.getContext("2d",{alpha:!0,desynchronized:!1});if(!e)throw new Error("Could not get 2d context");e.imageSmoothingEnabled=!0,e.imageSmoothingQuality="high",this.context=e,this.canvas=t,this.startTimer(),this.refresh()}startTimer(){this.timeRemaining=60,this.timerInterval=window.setInterval(()=>{this.timeRemaining-=1,this.timeRemaining<=0&&(this.timeRemaining=0,this.stopTimer(),this.handleTimeUp()),this.refresh()},1e3)}stopTimer(){this.timerInterval!==void 0&&(clearInterval(this.timerInterval),this.timerInterval=void 0)}getTimeRemaining(){return this.timeRemaining}handleTimeUp(){var l;if(this.fighters.length<2)return;const t=this.fighters[0],e=this.fighters[1],s=t.getLife(),r=e.getLife();let n,a;if(s>r)n=t,a=e;else if(r>s)n=e,a=t;else{t.getMove().stop(),e.getMove().stop();return}t.getMove().stop(),e.getMove().stop(),n.setMove(i.WIN),a.setMove(i.FALL);const c=(l=this.game.callbacks)==null?void 0:l["game-end"];typeof c=="function"&&c.call(null,a)}destroy(){this.stopTimer(),this.canvas&&this.container.contains(this.canvas)&&this.container.removeChild(this.canvas),this.canvas=void 0,this.context=void 0,this.container=void 0,this.game=void 0,this.fighters=void 0,this.arena=void 0}drawArena(){if(this.context)if(this.texture)this.context.drawImage(this.texture,0,0,this.texture.width,this.texture.height,0,0,this.width,this.height);else{const t=document.createElement("img");t.src=`${u.IMAGES}${u.ARENAS}${this.arena}/arena.png`,t.onload=()=>{this.texture=t,this.context&&this.context.drawImage(t,0,0,t.width,t.height,0,0,this.width,this.height)}}}refresh(){if(!this.context)return;this.drawArena(),this.drawStaticHealthBars();const t=3;for(let e=0;e<this.fighters.length;e+=1){const s=this.fighters[e],r=s.getState();if(r){const n=r.width*t,a=r.height*t,c=r.height*(t-1);this.context.drawImage(r,s.getX(),s.getY()-c,n,a)}}}drawStaticHealthBars(){if(!this.context||this.fighters.length<2)return;const t=20,e=24,s=400,r=this.fighters[0],n=this.fighters[1],a=56,c=t;this.drawPlayerHealthBar(r,c,a,s,e,!0,1);const l=this.width-t-s;this.drawPlayerHealthBar(n,l,a,s,e,!1,2),this.drawTimer(a)}drawTimer(t){if(!this.context)return;const e=Math.round(this.width/2),s=t,r=Math.max(0,this.timeRemaining);this.context.fillStyle="rgba(50, 50, 50, 0.5)",this.context.beginPath(),this.context.arc(e,s,36,0,Math.PI*2),this.context.fill(),this.context.strokeStyle=this.timeRemaining<=10?"#FF0000":"#EEEEEE",this.context.lineWidth=6,this.context.stroke(),this.context.fillStyle=this.timeRemaining<=10?"#FF0000":"#EEEEEE",this.context.font="bold 32px Arial",this.context.textAlign="center",this.context.textBaseline="middle",this.context.fillText(r.toString(),e,s)}drawRoundedRect(t,e,s,r,n){this.context&&(this.context.beginPath(),this.context.moveTo(t+n,e),this.context.lineTo(t+s-n,e),this.context.quadraticCurveTo(t+s,e,t+s,e+n),this.context.lineTo(t+s,e+r-n),this.context.quadraticCurveTo(t+s,e+r,t+s-n,e+r),this.context.lineTo(t+n,e+r),this.context.quadraticCurveTo(t,e+r,t,e+r-n),this.context.lineTo(t,e+n),this.context.quadraticCurveTo(t,e,t+n,e),this.context.closePath())}drawPlayerHealthBar(t,e,s,r,n,a,c){if(!this.context)return;const P=t.getLife()/100,E=`Player ${c}`,m=Math.round(e),S=Math.round(s);this.context.fillStyle="#EEEEEE",this.context.font="bold 22px Arial",this.context.textAlign=a?"left":"right",this.context.textBaseline="top";const y=a?m:m+r,x=S-32;this.context.fillText(E,y,x);const C=12;this.context.fillStyle="#8B0000",this.drawRoundedRect(m,S,r,n,C),this.context.fill();const w=r*P;if(w>0){if(P>.5){const U=Math.floor(255*((P-.5)*2));this.context.fillStyle=`rgb(${255-U}, 255, 0)`}else{const U=Math.floor(255*(1-P*2));this.context.fillStyle=`rgb(255, ${U}, 0)`}this.context.save(),this.drawRoundedRect(m,S,w,n,C),this.context.clip(),this.context.fillRect(m,S,w,n),this.context.restore()}}moveFighter(t,e){const s=this.game.getOpponent(t),r={x:s.getX(),y:s.getY()},n=e.y+t.getVisibleHeight()<=r.y;return e.x<=0&&(e.x=0),e.x>=this.width-t.getVisibleWidth()&&(e.x=this.width-t.getVisibleWidth()),n||(t.getOrientation()===f.LEFT?e.x+t.getVisibleWidth()>r.x&&(e=this.synchronizeFighters(e,t,s)):e.x<r.x+s.getVisibleWidth()&&(e=this.synchronizeFighters(e,t,s))),this.setFightersOrientation(t,s),e}synchronizeFighters(t,e,s){const r=e.getMove().type;if(r===i.FORWARD_JUMP||r===i.BACKWARD_JUMP)return t.x=e.getX(),t;let n;return e.getOrientation()===f.LEFT?(n=Math.min(this.width-(s.getX()+s.getVisibleWidth()+e.getVisibleWidth()),t.x-e.getX()),t.x=e.getX()+n,n>0&&s.setX(s.getX()+n)):(n=Math.min(s.getX(),e.getX()-t.x),n>0?(t.x=e.getX()-n,s.setX(s.getX()-n),s.getX()+s.getWidth()>t.x&&(t.x=s.getX()+s.getVisibleWidth())):(t.x=e.getX(),s.getX()+s.getWidth()>t.x&&(t.x=s.getX()+s.getVisibleWidth()))),t}setFightersOrientation(t,e){t.getX()<e.getX()?(t.setOrientation(f.LEFT),e.setOrientation(f.RIGHT)):(t.setOrientation(f.RIGHT),e.setOrientation(f.LEFT))}}class _{constructor(t,e,s){o(this,"owner");o(this,"type");o(this,"stepDuration");o(this,"interval",-1);o(this,"currentStep",0);o(this,"actionPending",null);o(this,"steps",{left:[],right:[]});o(this,"totalSteps",0);this.owner=t,this.type=e,this.stepDuration=s||u.STEP_DURATION}go(t){typeof this._beforeGo=="function"&&this._beforeGo.call(this),this.currentStep=t||0,this.nextStep(()=>{typeof this._action=="function"&&this._action.call(this)}),this.interval=window.setInterval(()=>{this.nextStep(()=>{typeof this._action=="function"&&this._action.call(this)})},this.stepDuration)}nextStep(t){const e=this.steps[this.owner.getOrientation()][this.currentStep];this.owner.setState(e),t(),this.owner.refresh(),this.moveNextStep()}init(t){let e=0;const s={LEFT:"left",RIGHT:"right"};this.steps={left:[],right:[]};for(let r=0;r<this.totalSteps;r+=1)for(const n in s){const a=s[n],c=document.createElement("img");c.onload=()=>{e+=1,e===this.totalSteps*2&&t()},c.src=this.getImageUrl(r,a),this.steps[a].push(c)}typeof this.addHandlers=="function"&&this.addHandlers.call(this)}getImageUrl(t,e){return`${u.IMAGES}${u.FIGHTERS}${this.owner.getName()}/${e}/${this.type}/${t}.png`}stop(t){if(typeof this._beforeStop=="function"&&this._beforeStop.call(this),this.interval!==-1&&(clearInterval(this.interval),this.interval=-1),typeof this.actionPending=="function"){const e=this.actionPending;this.actionPending=null,e()}}}class v extends _{constructor(t,e,s,r){super(t,e,r),this.totalSteps=s}moveNextStep(){this.currentStep+=1,this.currentStep=this.currentStep%this.totalSteps}}class F extends v{constructor(t){super(t,i.STAND,9)}_beforeGo(){this.owner.setY(u.PLAYER_TOP)}}class k extends v{constructor(t){super(t,i.WALK,9)}_action(){this.owner.setX(this.owner.getX()+10),this.owner.setY(u.PLAYER_TOP)}}class Y extends v{constructor(t){super(t,i.WALK_BACKWARD,9)}_action(){this.owner.setX(this.owner.getX()-10),this.owner.setY(u.PLAYER_TOP)}}class A extends _{constructor(e,s,r){super(e,s,r);o(this,"bottom");this.bottom=void 0}moveNextStep(){this.currentStep>=this.totalSteps-1?this.currentStep=this.totalSteps-1:this.currentStep+=1}_beforeGo(){this.bottom=this.owner.getBottom(),this.owner.lock()}_beforeStop(){this.owner.unlock()}keepDistance(){if(this.bottom===void 0)return;const e=this.owner.getBottom();e>this.bottom&&this.owner.setY(this.owner.getY()+e-this.bottom),e<this.bottom&&this.owner.setY(this.owner.getY()-(this.bottom-e))}}class G extends A{constructor(t){super(t,i.SQUAT,40),this.totalSteps=3}_action(){this.keepDistance(),this.currentStep===2&&this.stop()}}class X extends A{constructor(t){super(t,i.BLOCK,40),this.totalSteps=3}_action(){this.keepDistance(),this.currentStep===2&&this.stop()}}class Q extends A{constructor(t){super(t,i.STAND_UP,100),this.totalSteps=3}_action(){this.currentStep===2&&(this.stop(),this.owner.setMove(i.STAND),this.owner.setY(u.PLAYER_TOP)),this.keepDistance()}}class $ extends A{constructor(t){super(t,i.ATTRACTIVE_STAND_UP,100),this.totalSteps=4}_action(){this.currentStep===this.totalSteps-1?(this.stop(),this.owner.setMove(i.STAND)):this.keepDistance()}_beforeStop(){this.owner.unlock(),this.owner.setY(u.PLAYER_TOP)}}class g extends _{constructor(e,s,r,n,a,c,l){super(e,s,a||40);o(this,"damage");o(this,"moveBack",!1);o(this,"hitPassed",!1);o(this,"returnStand");o(this,"returnStandStep");o(this,"dontReturn",!1);o(this,"bottom");this.damage=n,this.totalSteps=r,this.returnStand=c||i.STAND,this.returnStandStep=l||0}moveNextStep(){this.moveBack||(this.currentStep+=1),this.moveBack&&(this.currentStep-=1,this.currentStep<=0&&(this.stop(),this.owner.setMove(this.returnStand,this.returnStandStep))),this.currentStep>=this.totalSteps&&(this.dontReturn?(this.stop(),this.owner.setMove(this.returnStand)):(this.moveBack=!0,this.currentStep-=1))}_action(){this.keepDistance(),!this.hitPassed&&this.currentStep===Math.round(this.totalSteps/2)&&(this.owner.attack(this.getDamage()),this.hitPassed=!0)}getDamage(){return this.damage}_beforeStop(){this.owner.unlock()}_beforeGo(){this.moveBack=!1,this.hitPassed=!1,this.owner.lock(),this.bottom=this.owner.getBottom()}keepDistance(){if(this.bottom===void 0)return;const e=this.owner.getBottom();e>this.bottom&&this.owner.setY(this.owner.getY()+e-this.bottom),e<this.bottom&&this.owner.setY(this.owner.getY()-(this.bottom-e))}}class V extends g{constructor(t){super(t,i.HIGH_KICK,7,10)}}class q extends g{constructor(t){super(t,i.LOW_KICK,6,6)}}class z extends g{constructor(t){super(t,i.SPIN_KICK,8,13,60,i.STAND),this.dontReturn=!0}}class j extends g{constructor(t){super(t,i.LOW_PUNCH,5,5)}}class Z extends g{constructor(t){super(t,i.HIGH_PUNCH,5,8)}}class tt extends g{constructor(t){super(t,i.UPPERCUT,5,13,60)}_beforeStop(){this.owner.unlock(),this.keepDistance()}_action(){this.keepDistance(),!this.hitPassed&&this.currentStep===Math.round(this.totalSteps/2)&&(this.owner.attack(this.getDamage()),this.hitPassed=!0)}}class et extends g{constructor(t){super(t,i.SQUAT_LOW_KICK,3,4,70,i.SQUAT,2)}}class it extends g{constructor(t){super(t,i.SQUAT_HIGH_KICK,4,6,70,i.SQUAT,2)}}class st extends g{constructor(t){super(t,i.SQUAT_LOW_PUNCH,3,4,70,i.SQUAT,2)}}class nt extends A{constructor(t){super(t,i.FALL,100),this.totalSteps=7}_action(){this.keepDistance()}}class rt extends _{constructor(t){super(t,i.KNOCK_DOWN,80),this.totalSteps=10}_action(){if(this.currentStep===this.totalSteps-1)this.stop(),this.owner.setMove(i.ATTRACTIVE_STAND_UP);else{let t=25;this.owner.getOrientation()===f.LEFT&&(t=-t),this.currentStep+1>(this.totalSteps-1)/2?(this.owner.setY(this.owner.getY()+10),this.owner.setX(this.owner.getX()+t)):(this.owner.setY(this.owner.getY()+10),this.owner.setX(this.owner.getX()+t))}}_beforeGo(){this.owner.lock()}_beforeStop(){this.owner.unlock()}moveNextStep(){this.currentStep+=1}}class ot extends A{constructor(t){super(t,i.WIN,100),this.totalSteps=10}_action(){this.keepDistance()}_beforeGo(){this.owner.lock(),this.owner.setY(u.PLAYER_TOP),this.bottom=this.owner.getBottom()}}class ht extends _{constructor(e){super(e,i.JUMP,60);o(this,"moveBack",!1);this.totalSteps=6,this.moveBack=!1}moveNextStep(){this.moveBack||(this.currentStep+=1),this.moveBack&&(this.currentStep-=1,this.currentStep<=0&&(this.stop(),this.owner.setMove(i.STAND))),this.currentStep>=this.totalSteps&&(this.moveBack=!0,this.currentStep-=1)}_action(){this.moveBack?this.currentStep===this.totalSteps-1?this.owner.setY(this.owner.getY()-20):this.owner.setY(this.owner.getY()+25):this.currentStep===0?this.owner.setY(this.owner.getY()+20):this.owner.setY(this.owner.getY()-20)}_beforeStop(){this.owner.unlock()}_beforeGo(){this.moveBack=!1,this.owner.lock()}}class I extends g{constructor(e,s,r,n){super(e,s,3,r,80);o(this,"offset");o(this,"totalPics",2);o(this,"counter",0);this.offset={x:-23,y:26},n&&(this.offset={x:23,y:26}),this.totalPics=2,this.counter=0}moveNextStep(){this.currentStep+=1,this.counter+=1,this.totalPics<=this.currentStep&&(this.currentStep=this.totalPics),this.counter>=this.totalSteps&&this.owner.getMove().type!==i.WIN&&(this.stop(),this.owner.setMove(i.STAND),this.owner.setY(u.PLAYER_TOP))}_action(){!this.hitPassed&&this.currentStep===this.totalPics&&(this.owner.attack(this.getDamage()),this.hitPassed=!0),this.owner.setY(this.owner.getY()+this.offset.y),this.owner.setX(this.owner.getX()+this.offset.x)}_beforeGo(){this.hitPassed=!1,this.counter=0,this.owner.lock()}}class R extends I{constructor(t,e){const s=e?i.FORWARD_JUMP_KICK:i.BACKWARD_JUMP_KICK;super(t,s,10,e)}}class D extends I{constructor(t,e){const s=e?i.FORWARD_JUMP_PUNCH:i.BACKWARD_JUMP_PUNCH;super(t,s,9,e)}}class at extends _{constructor(e){super(e,i.FORWARD_JUMP,80);o(this,"ownerHeight");this.totalSteps=8,this.ownerHeight=e.getVisibleHeight()}_beforeStop(){this.owner.unlock(),this.owner.setHeight(this.ownerHeight)}_beforeGo(){this.owner.lock(),this.owner.setHeight(this.ownerHeight/2)}moveNextStep(){this.currentStep+=1,this.currentStep>=this.totalSteps&&(this.stop(),this.owner.setMove(i.STAND))}_action(){this.currentStep>(this.totalSteps-1)/2?(this.owner.setY(this.owner.getY()+26),this.owner.setX(this.owner.getX()+23)):(this.owner.setY(this.owner.getY()-26),this.owner.setX(this.owner.getX()+23))}}class ct extends _{constructor(e){super(e,i.BACKWARD_JUMP,80);o(this,"ownerHeight");this.totalSteps=8,this.ownerHeight=e.getVisibleHeight()}_beforeStop(){this.owner.unlock(),this.owner.setHeight(this.ownerHeight)}_beforeGo(){this.owner.lock(),this.owner.setHeight(this.ownerHeight/2)}moveNextStep(){this.currentStep+=1,this.currentStep>=this.totalSteps&&(this.stop(),this.owner.setMove(i.STAND))}_action(){this.currentStep>(this.totalSteps-1)/2?(this.owner.setY(this.owner.getY()+26),this.owner.setX(this.owner.getX()-23)):(this.owner.setY(this.owner.getY()-26),this.owner.setX(this.owner.getX()-23))}}class lt extends _{constructor(t){super(t,i.ENDURE),this.totalSteps=3}_action(){this.currentStep===this.totalSteps-1&&(this.stop(),this.owner.setMove(i.STAND))}_beforeGo(){this.owner.lock()}_beforeStop(){this.owner.unlock()}moveNextStep(){this.currentStep+=1}}class ut extends _{constructor(e){super(e,i.SQUAT_ENDURE);o(this,"bottom");this.totalSteps=3}_action(){this.currentStep===this.totalSteps-1&&(this.stop(),this.owner.setMove(i.SQUAT)),this.keepDistance()}_beforeGo(){this.owner.lock(),this.bottom===void 0&&(this.bottom=this.owner.getBottom())}_beforeStop(){this.owner.unlock()}moveNextStep(){this.currentStep+=1}keepDistance(){if(this.bottom===void 0)return;const e=this.owner.getBottom();e>this.bottom&&this.owner.setY(this.owner.getY()+e-this.bottom),e<this.bottom&&this.owner.setY(this.owner.getY()-(this.bottom-e))}}class ft{constructor(t){o(this,"name");o(this,"arena");o(this,"game");o(this,"life",100);o(this,"orientation");o(this,"width",30);o(this,"height",60);o(this,"locked",!1);o(this,"position");o(this,"currentState");o(this,"currentMove");o(this,"moves",{});const e=t.name.toLowerCase();if(e!=="subzero"&&e!=="kano")throw new Error("Invalid fighter name!");this.name=e,this.arena=t.arena,this.game=t.game,this.orientation=t.orientation,this.position={x:100,y:u.PLAYER_TOP}}init(t){this.moves[i.STAND]=new F(this),this.moves[i.WALK]=new k(this),this.moves[i.WALK_BACKWARD]=new Y(this),this.moves[i.SQUAT]=new G(this),this.moves[i.BLOCK]=new X(this),this.moves[i.STAND_UP]=new Q(this),this.moves[i.ATTRACTIVE_STAND_UP]=new $(this),this.moves[i.HIGH_KICK]=new V(this),this.moves[i.LOW_KICK]=new q(this),this.moves[i.SPIN_KICK]=new z(this),this.moves[i.LOW_PUNCH]=new j(this),this.moves[i.HIGH_PUNCH]=new Z(this),this.moves[i.UPPERCUT]=new tt(this),this.moves[i.SQUAT_LOW_KICK]=new et(this),this.moves[i.SQUAT_HIGH_KICK]=new it(this),this.moves[i.SQUAT_LOW_PUNCH]=new st(this),this.moves[i.FALL]=new nt(this),this.moves[i.KNOCK_DOWN]=new rt(this),this.moves[i.WIN]=new ot(this),this.moves[i.JUMP]=new ht(this),this.moves[i.FORWARD_JUMP_KICK]=new R(this,!0),this.moves[i.BACKWARD_JUMP_KICK]=new R(this,!1),this.moves[i.FORWARD_JUMP_PUNCH]=new D(this,!0),this.moves[i.BACKWARD_JUMP_PUNCH]=new D(this,!1),this.moves[i.ENDURE]=new lt(this),this.moves[i.SQUAT_ENDURE]=new ut(this),this.moves[i.FORWARD_JUMP]=new at(this),this.moves[i.BACKWARD_JUMP]=new ct(this);let e=0;const s=Object.keys(this.moves).length;for(const r in this.moves)this.moves[r].init(()=>{e+=1,e===s&&typeof t=="function"&&t()})}isJumping(){if(!this.currentMove)return!1;const t=this.currentMove.type;return t===i.JUMP||t===i.BACKWARD_JUMP||t===i.FORWARD_JUMP||t===i.FORWARD_JUMP_KICK||t===i.BACKWARD_JUMP_KICK||t===i.FORWARD_JUMP_PUNCH||t===i.BACKWARD_JUMP_PUNCH}getName(){return this.name}setArena(t){this.arena=t}getWidth(){return this.currentState&&this.currentState.width?this.currentState.width:this.width}getVisibleWidth(){return this.width}getVisibleHeight(){return this.currentState&&this.currentState.height?this.currentState.height:this.height}setHeight(t){this.height=t}setWidth(t){this.width=t}setOrientation(t){this.orientation=t}getOrientation(){return this.orientation}refresh(){this.arena&&typeof this.arena.refresh=="function"&&this.arena.refresh()}getX(){return this.position.x}lock(){this.locked=!0}unlock(){this.locked=!1}getY(){return this.position.y}setX(t){this.arena?this.position.x=this.arena.moveFighter(this,{x:t,y:this.getY()}).x:this.position.x=t}setY(t){this.position.y=t}setState(t){this.currentState=t}getState(){return this.currentState}attack(t){this.game.fighterAttacked(this,t)}endureAttack(t,e){return this.getMove().type===i.BLOCK?t*=u.BLOCK_DAMAGE:(this.unlock(),this.getMove().type===i.SQUAT?this.setMove(i.SQUAT_ENDURE):e===i.UPPERCUT||e===i.SPIN_KICK?this.setMove(i.KNOCK_DOWN):this.setMove(i.ENDURE)),this.setLife(this.getLife()-t),this.getLife()===0&&(this.game.fighterDead(this),this.unlock(),this.setMove(i.FALL)),this.getLife()}setLife(t){this.life=Math.max(t,0)}getLife(){return this.life}getBottom(){if(!this.arena||!this.currentState)return 0;const t=this.currentState.height+this.getY();return this.arena.height-t}setMove(t,e){var r;e=e||0;const s=this.currentMove;if(!(t in this.moves))throw new Error(`This player does not have the move - ${t}`);this.currentMove&&this.currentMove.type===t||((t===i.FORWARD_JUMP_KICK||t===i.BACKWARD_JUMP_KICK||t===i.FORWARD_JUMP_PUNCH||t===i.BACKWARD_JUMP_PUNCH)&&s&&s._currentStep>=s._totalSteps/2&&((r=this.currentMove)==null||r.stop(),this.unlock(),this.currentMove=this.moves[t],this.currentMove._totalSteps=s._totalSteps-s._currentStep),!(this.locked&&t!==i.WIN)&&(this.currentMove&&typeof this.currentMove.stop=="function"&&this.currentMove.stop(),this.currentMove=this.moves[t],this.currentMove.go(e)))}getMove(){if(!this.currentMove)throw new Error("No current move set");return this.currentMove}}class M{constructor(t){o(this,"fighters",[]);o(this,"opponents",new Map);o(this,"arena");o(this,"callbacks");this.callbacks=t.callbacks||{},this.initializeFighters(t.fighters);const e={fighters:this.fighters,arena:t.arena.arena,width:t.arena.width,height:t.arena.height,container:t.arena.container,game:this};this.arena=new J(e)}initializeFighters(t){this.fighters=[],this.opponents=new Map;for(let e=0;e<t.length;e+=1){const s=t[e],r=e===0?f.LEFT:f.RIGHT;this.fighters.push(new ft({name:s.name,arena:void 0,orientation:r,game:this}))}this.fighters.length>=2&&(this.opponents.set(this.fighters[0].getName(),this.fighters[1]),this.opponents.set(this.fighters[1].getName(),this.fighters[0]))}getOpponent(t){const e=this.opponents.get(t.getName());if(!e)throw new Error("Opponent not found");return e}init(t){let e=0;const s=this.fighters.length,r=this;for(let n=0;n<this.fighters.length;n+=1){const a=this.fighters[n];a.init(()=>{a.setMove(i.STAND),e+=1,e===s&&(r.arena.init(),r.setFightersArena(),r.initialize(),t.initialized())})}}setFightersArena(){for(let t=0;t<this.fighters.length;t+=1)this.fighters[t].setArena(this.arena);this.fighters[1].setX(940)}fighterAttacked(t,e){const s=this.getOpponent(t),r=s.getLife();if(this.requiredDistance(t,s)&&this.attackCompatible(t.getMove().type,s.getMove().type)){s.endureAttack(e,t.getMove().type);const n=this.callbacks.attack;typeof n=="function"&&n.call(null,t,s,r-s.getLife())}}attackCompatible(t,e){return!(e===i.SQUAT&&t!==i.LOW_PUNCH&&t!==i.LOW_KICK)}requiredDistance(t,e){const s=t.getX()+t.getWidth()/2,r=e.getX()+e.getWidth()/2,n=Math.abs(s-r),a=t.getMove().type,c=e.getWidth();return n<=c||a===i.UPPERCUT&&n<=c*1.2||(a===i.BACKWARD_JUMP_KICK||a===i.FORWARD_JUMP_KICK||a===i.FORWARD_JUMP_PUNCH||a===i.BACKWARD_JUMP_PUNCH)&&n<=c*1.5}fighterDead(t){const e=this.getOpponent(t),s=this.callbacks["game-end"];e.getMove().stop(),e.setMove(i.WIN),typeof s=="function"&&s.call(null,t)}reset(){this.fighters.forEach(t=>{t.getMove().stop()}),this.fighters=[],this.opponents=new Map,this.arena.destroy(),this.arena=void 0,this.callbacks={}}}class gt{constructor(){o(this,"callbacks",[])}initialized(){this.callbacks.forEach(t=>{typeof t=="function"&&t()})}ready(t){this.callbacks.push(t)}}const K={RIGHT:39,LEFT:37,UP:38,DOWN:40,BLOCK:16,HP:65,LP:83,LK:68,HK:70};class W extends M{constructor(e){super(e);o(this,"player",0);o(this,"pressed",{})}initialize(){this.player=0,this.addHandlers()}addHandlers(){const e=this.fighters[this.player];document.addEventListener("keydown",s=>{this.pressed[s.keyCode]=!0;const r=this.getMove(this.pressed,K,this.player);this.moveFighter(e,r)},!1),document.addEventListener("keyup",s=>{delete this.pressed[s.keyCode];const r=this.getMove(this.pressed,K,this.player);this.moveFighter(e,r)},!1)}moveFighter(e,s){s&&e.setMove(s)}getMove(e,s,r){const n=this.fighters[r],a=f.LEFT,c=f.RIGHT,l=n.getOrientation();return n.getMove().type===i.SQUAT&&!e[s.DOWN]?i.STAND_UP:n.getMove().type===i.BLOCK&&!e[s.BLOCK]||Object.keys(e).length===0?i.STAND:e[s.BLOCK]?i.BLOCK:e[s.LEFT]?e[s.UP]?i.BACKWARD_JUMP:e[s.HK]&&l===a?i.SPIN_KICK:i.WALK_BACKWARD:e[s.RIGHT]?e[s.UP]?i.FORWARD_JUMP:e[s.HK]&&l===c?i.SPIN_KICK:i.WALK:e[s.DOWN]?e[s.HP]?i.UPPERCUT:e[s.LK]?i.SQUAT_LOW_KICK:e[s.HK]?i.SQUAT_HIGH_KICK:e[s.LP]?i.SQUAT_LOW_PUNCH:i.SQUAT:e[s.HK]?n.getMove().type===i.FORWARD_JUMP?i.FORWARD_JUMP_KICK:n.getMove().type===i.BACKWARD_JUMP?i.BACKWARD_JUMP_KICK:i.HIGH_KICK:e[s.UP]?i.JUMP:e[s.LK]?n.getMove().type===i.FORWARD_JUMP?i.FORWARD_JUMP_KICK:n.getMove().type===i.BACKWARD_JUMP?i.BACKWARD_JUMP_KICK:i.LOW_KICK:e[s.LP]?n.getMove().type===i.FORWARD_JUMP?i.FORWARD_JUMP_PUNCH:n.getMove().type===i.BACKWARD_JUMP?i.BACKWARD_JUMP_PUNCH:i.LOW_PUNCH:e[s.HP]?n.getMove().type===i.FORWARD_JUMP?i.FORWARD_JUMP_PUNCH:n.getMove().type===i.BACKWARD_JUMP?i.BACKWARD_JUMP_PUNCH:i.HIGH_PUNCH:null}}const T={RIGHT:74,LEFT:71,UP:89,DOWN:72,BLOCK:16,HP:65,LP:83,LK:68,HK:70},O={RIGHT:39,LEFT:37,UP:38,DOWN:40,BLOCK:17,HP:80,LP:219,LK:221,HK:220};class _t extends M{constructor(e){super(e);o(this,"pressed",{})}initialize(){this.addHandlers()}addHandlers(){const e=this.fighters[0],s=this.fighters[1];document.addEventListener("keydown",r=>{this.pressed[r.keyCode]=!0;let n=this.getMove(this.pressed,T,0);this.moveFighter(e,n),n=this.getMove(this.pressed,O,1),this.moveFighter(s,n)},!1),document.addEventListener("keyup",r=>{delete this.pressed[r.keyCode];let n=this.getMove(this.pressed,T,0);this.moveFighter(e,n),n=this.getMove(this.pressed,O,1),this.moveFighter(s,n)},!1)}getMove(e,s,r){const n=this.fighters[r],a="left",c="right",l=n.getOrientation();return n.getMove().type===i.SQUAT&&!e[s.DOWN]?i.STAND_UP:n.getMove().type===i.BLOCK&&!e[s.BLOCK]||Object.keys(e).length===0?i.STAND:e[s.BLOCK]?i.BLOCK:e[s.LEFT]?e[s.UP]?i.BACKWARD_JUMP:e[s.HK]&&l===a?i.SPIN_KICK:i.WALK_BACKWARD:e[s.RIGHT]?e[s.UP]?i.FORWARD_JUMP:e[s.HK]&&l===c?i.SPIN_KICK:i.WALK:e[s.DOWN]?e[s.HP]?i.UPPERCUT:e[s.LK]?i.SQUAT_LOW_KICK:e[s.HK]?i.SQUAT_HIGH_KICK:e[s.LP]?i.SQUAT_LOW_PUNCH:i.SQUAT:e[s.HK]?n.getMove().type===i.FORWARD_JUMP?i.FORWARD_JUMP_KICK:n.getMove().type===i.BACKWARD_JUMP?i.BACKWARD_JUMP_KICK:i.HIGH_KICK:e[s.UP]?i.JUMP:e[s.LK]?n.getMove().type===i.FORWARD_JUMP?i.FORWARD_JUMP_KICK:n.getMove().type===i.BACKWARD_JUMP?i.BACKWARD_JUMP_KICK:i.LOW_KICK:e[s.LP]?n.getMove().type===i.FORWARD_JUMP?i.FORWARD_JUMP_PUNCH:n.getMove().type===i.BACKWARD_JUMP?i.BACKWARD_JUMP_PUNCH:i.LOW_PUNCH:e[s.HP]?n.getMove().type===i.FORWARD_JUMP?i.FORWARD_JUMP_PUNCH:n.getMove().type===i.BACKWARD_JUMP?i.BACKWARD_JUMP_PUNCH:i.HIGH_PUNCH:null}moveFighter(e,s){s&&e.setMove(s)}}const p={EVENT:"event",LIFE_UPDATE:"life-update",POSITION_UPDATE:"position-update",PLAYER_CONNECTED:"player-connected"},H={CREATE_GAME:"create-game",JOIN_GAME:"join-game"},pt={SUCCESS:0};class At extends M{constructor(e){super(e);o(this,"isHost");o(this,"gameName");o(this,"transport");o(this,"player",0);o(this,"pressed",{});this.isHost=e.isHost,this.gameName=e.gameName,this.transport=e.transport}initialize(){this.isHost?this.player=1:this.player=0,this.addHandlers(),this.transport&&(this.transport.on("connect",()=>{this.isHost?this.createGame():this.joinGame()}),this.transport.on("response",e=>{e!==pt.SUCCESS&&alert("Error while connecting to the server.")}),this.transport.on("disconnect",()=>{alert("Disconnected from the server.")}))}addHandlers(){const e=this.fighters[this.player];document.addEventListener("keydown",s=>{this.pressed[s.keyCode]=!0;const r=this.getMove(this.pressed,K,this.player);this.moveFighter(e,r)},!1),document.addEventListener("keyup",s=>{delete this.pressed[s.keyCode];const r=this.getMove(this.pressed,K,this.player);this.moveFighter(e,r)},!1)}getMove(e,s,r){const n=this.fighters[r],a="left",c="right",l=n.getOrientation();return n.getMove().type===i.SQUAT&&!e[s.DOWN]?i.STAND_UP:n.getMove().type===i.BLOCK&&!e[s.BLOCK]||Object.keys(e).length===0?i.STAND:e[s.BLOCK]?i.BLOCK:e[s.LEFT]?e[s.UP]?i.BACKWARD_JUMP:e[s.HK]&&l===a?i.SPIN_KICK:i.WALK_BACKWARD:e[s.RIGHT]?e[s.UP]?i.FORWARD_JUMP:e[s.HK]&&l===c?i.SPIN_KICK:i.WALK:e[s.DOWN]?e[s.HP]?i.UPPERCUT:e[s.LK]?i.SQUAT_LOW_KICK:e[s.HK]?i.SQUAT_HIGH_KICK:e[s.LP]?i.SQUAT_LOW_PUNCH:i.SQUAT:e[s.HK]?n.getMove().type===i.FORWARD_JUMP?i.FORWARD_JUMP_KICK:n.getMove().type===i.BACKWARD_JUMP?i.BACKWARD_JUMP_KICK:i.HIGH_KICK:e[s.UP]?i.JUMP:e[s.LK]?n.getMove().type===i.FORWARD_JUMP?i.FORWARD_JUMP_KICK:n.getMove().type===i.BACKWARD_JUMP?i.BACKWARD_JUMP_KICK:i.LOW_KICK:e[s.LP]?n.getMove().type===i.FORWARD_JUMP?i.FORWARD_JUMP_PUNCH:n.getMove().type===i.BACKWARD_JUMP?i.BACKWARD_JUMP_PUNCH:i.LOW_PUNCH:e[s.HP]?n.getMove().type===i.FORWARD_JUMP?i.FORWARD_JUMP_PUNCH:n.getMove().type===i.BACKWARD_JUMP?i.BACKWARD_JUMP_PUNCH:i.HIGH_PUNCH:null}createGame(){this.transport&&(this.transport.emit(H.CREATE_GAME,this.gameName),this.addSocketHandlers())}joinGame(){this.transport&&(this.transport.emit(H.JOIN_GAME,this.gameName),this.addSocketHandlers())}addSocketHandlers(){if(!this.transport)return;const e=this.fighters[+!this.player],s=this.fighters[this.player],r=this;this.transport.on(p.EVENT,n=>{e.setMove(n)}),this.transport.on(p.LIFE_UPDATE,n=>{e.setLife(n)}),this.transport.on(p.POSITION_UPDATE,n=>{e.setX(n.x),e.setY(n.y)}),setInterval(()=>{r.transport&&r.transport.emit(p.LIFE_UPDATE,s.getLife())},2e3),setInterval(()=>{!s.isJumping()&&r.transport&&r.transport.emit(p.POSITION_UPDATE,{x:s.getX(),y:s.getY()})},500),this.isHost&&this.transport.on(p.PLAYER_CONNECTED,()=>{const n=this.callbacks["player-connected"];typeof n=="function"&&n()})}moveFighter(e,s){s&&this.transport&&(this.transport.emit(p.EVENT,s),e.setMove(s))}}let d=null;function mt(h){const t=(h.gameType||"basic").toLowerCase(),e=new gt;switch(t){case"basic":d=new W(h);break;case"network":d=new At(h);break;case"multiplayer":d=new _t(h);break;default:d=new W(h)}return d.init(e),e}const L=document.getElementById("app");if(!L)throw new Error("App element not found");const dt=mt({arena:{container:L,arena:N.TOWER,width:1200,height:800},fighters:[{name:"subzero"},{name:"kano"}],gameType:"basic",callbacks:{attack:(h,t,e)=>{console.log(`${h.getName()} attacked ${t.getName()} for ${e} damage`)},"game-end":h=>{console.log(`Game ended! ${h.getName()} lost`)}}});dt.ready(()=>{console.log("Game initialized and ready!")});
